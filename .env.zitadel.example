# Zitadel OIDC Configuration for lurus-api Multi-Tenant SaaS
# Zitadel OIDC 配置 - lurus-api 多租户 SaaS

# ================================
# Zitadel Instance / Zitadel 实例
# ================================

# Zitadel Issuer URL (OIDC Issuer)
# Zitadel 签发者 URL（OIDC Issuer）
ZITADEL_ISSUER=https://auth.lurus.cn

# ================================
# OAuth 2.0 Client Credentials
# OAuth 2.0 客户端凭据
# ================================

# OIDC Client ID (format: {project_id}@{project_name})
# OIDC 客户端 ID（格式：{project_id}@{project_name}）
# Example: 234567890123456789@lurus-api
ZITADEL_CLIENT_ID=YOUR_CLIENT_ID_HERE

# OIDC Client Secret (generate from Zitadel console)
# OIDC 客户端密钥（从 Zitadel 控制台生成）
# WARNING: Keep this secret! Do not commit to git!
# 警告：保密！不要提交到 git！
ZITADEL_CLIENT_SECRET=YOUR_CLIENT_SECRET_HERE

# ================================
# Redirect URIs / 重定向 URI
# ================================

# OAuth Callback URL (where Zitadel redirects after login)
# OAuth 回调 URL（Zitadel 登录后重定向地址）
# Production: https://api.lurus.cn/api/v2/oauth/callback
# Development: http://localhost:8850/api/v2/oauth/callback
ZITADEL_REDIRECT_URI=https://api.lurus.cn/api/v2/oauth/callback

# Post Logout Redirect URI (where to redirect after logout)
# 登出后重定向 URI
ZITADEL_POST_LOGOUT_REDIRECT_URI=https://api.lurus.cn/logout

# ================================
# OIDC Endpoints / OIDC 端点
# ================================

# JWKS URI (for JWT public key verification)
# JWKS URI（用于 JWT 公钥验证）
ZITADEL_JWKS_URI=https://auth.lurus.cn/oauth/v2/keys

# Authorization Endpoint (OAuth 2.0 authorization)
# 授权端点（OAuth 2.0 授权）
ZITADEL_AUTHORIZATION_ENDPOINT=https://auth.lurus.cn/oauth/v2/authorize

# Token Endpoint (exchange authorization code for tokens)
# Token 端点（用授权码交换 token）
ZITADEL_TOKEN_ENDPOINT=https://auth.lurus.cn/oauth/v2/token

# UserInfo Endpoint (get user information)
# UserInfo 端点（获取用户信息）
ZITADEL_USERINFO_ENDPOINT=https://auth.lurus.cn/oidc/v1/userinfo

# End Session Endpoint (logout)
# 结束会话端点（登出）
ZITADEL_END_SESSION_ENDPOINT=https://auth.lurus.cn/oidc/v1/end_session

# Introspection Endpoint (validate tokens)
# 内省端点（验证 token）
ZITADEL_INTROSPECTION_ENDPOINT=https://auth.lurus.cn/oauth/v2/introspect

# ================================
# Default Organization / 默认组织
# ================================

# Default Organization ID (Lurus Platform)
# 默认组织 ID（Lurus Platform）
# Example: 123456789012345678
ZITADEL_DEFAULT_ORG_ID=YOUR_ORG_ID_HERE

# Default Organization Name
# 默认组织名称
ZITADEL_DEFAULT_ORG_NAME=Lurus Platform

# Default Organization Domain (for login page)
# 默认组织域名（用于登录页面）
ZITADEL_DEFAULT_ORG_DOMAIN=lurus

# ================================
# JWT Token Settings / JWT Token 设置
# ================================

# JWT Token Verification
# JWT Token 验证

# Verify JWT signature (recommended: true)
# 验证 JWT 签名（推荐：true）
ZITADEL_JWT_VERIFY_SIGNATURE=true

# Verify JWT expiration (recommended: true)
# 验证 JWT 过期时间（推荐：true）
ZITADEL_JWT_VERIFY_EXPIRATION=true

# Verify JWT issuer (recommended: true)
# 验证 JWT 签发者（推荐：true）
ZITADEL_JWT_VERIFY_ISSUER=true

# JWT Clock Skew (seconds, for clock drift tolerance)
# JWT 时钟偏移（秒，用于容忍时钟漂移）
ZITADEL_JWT_CLOCK_SKEW=60

# ================================
# JWKS Cache Settings / JWKS 缓存设置
# ================================

# JWKS Cache Refresh Interval (seconds)
# JWKS 缓存刷新间隔（秒）
ZITADEL_JWKS_CACHE_REFRESH_INTERVAL=3600

# JWKS Cache TTL (seconds, how long to keep cached keys)
# JWKS 缓存 TTL（秒，缓存密钥保留时间）
ZITADEL_JWKS_CACHE_TTL=86400

# ================================
# OAuth Scopes / OAuth 范围
# ================================

# OAuth 2.0 Scopes (space-separated)
# OAuth 2.0 范围（空格分隔）
# Available scopes: openid, email, profile, offline_access, address, phone
ZITADEL_OAUTH_SCOPES=openid email profile offline_access

# ================================
# Multi-Tenant Settings / 多租户设置
# ================================

# Enable Auto Tenant Creation (create tenant when new org detected)
# 启用自动租户创建（检测到新组织时创建租户）
ZITADEL_AUTO_CREATE_TENANT=true

# Enable Auto User Mapping (create lurus user when new Zitadel user login)
# 启用自动用户映射（新 Zitadel 用户登录时创建 lurus 用户）
ZITADEL_AUTO_CREATE_USER=true

# Default User Quota (for new users, in tokens)
# 默认用户额度（新用户，单位：token）
ZITADEL_DEFAULT_USER_QUOTA=10000

# Default User Role (for new users)
# 默认用户角色（新用户）
# Options: 1 (common user), 10 (admin)
ZITADEL_DEFAULT_USER_ROLE=1

# ================================
# Debug & Logging / 调试与日志
# ================================

# Enable Zitadel Auth Debug Logging
# 启用 Zitadel 认证调试日志
ZITADEL_DEBUG_LOGGING=false

# Log JWT Token Claims (WARNING: may log sensitive data)
# 记录 JWT Token 声明（警告：可能记录敏感数据）
ZITADEL_LOG_TOKEN_CLAIMS=false

# ================================
# Security Settings / 安全设置
# ================================

# Allowed Client IPs (comma-separated, empty = allow all)
# 允许的客户端 IP（逗号分隔，空 = 允许所有）
ZITADEL_ALLOWED_CLIENT_IPS=

# Enable PKCE (Proof Key for Code Exchange, recommended: true)
# 启用 PKCE（推荐：true）
ZITADEL_ENABLE_PKCE=true

# Enable State Parameter Verification (recommended: true)
# 启用 State 参数验证（推荐：true）
ZITADEL_VERIFY_STATE=true

# Session Timeout (seconds, how long session is valid)
# 会话超时（秒，会话有效时间）
ZITADEL_SESSION_TIMEOUT=86400

# ================================
# Integration Settings / 集成设置
# ================================

# Enable Zitadel Integration (set to false to use legacy auth)
# 启用 Zitadel 集成（设为 false 使用旧版认证）
ZITADEL_ENABLED=true

# Fallback to Legacy Auth (if Zitadel unavailable)
# 回退到旧版认证（如果 Zitadel 不可用）
ZITADEL_FALLBACK_TO_LEGACY=true

# ================================
# Notes / 备注
# ================================

# 1. Replace YOUR_CLIENT_ID_HERE with actual Client ID from Zitadel console
#    将 YOUR_CLIENT_ID_HERE 替换为 Zitadel 控制台的实际 Client ID
#
# 2. Replace YOUR_CLIENT_SECRET_HERE with actual Client Secret from Zitadel console
#    将 YOUR_CLIENT_SECRET_HERE 替换为 Zitadel 控制台的实际 Client Secret
#
# 3. Replace YOUR_ORG_ID_HERE with actual Organization ID from Zitadel console
#    将 YOUR_ORG_ID_HERE 替换为 Zitadel 控制台的实际 Organization ID
#
# 4. DO NOT commit .env.zitadel file to git! Add it to .gitignore
#    不要将 .env.zitadel 文件提交到 git！将其添加到 .gitignore
#
# 5. For production, use environment variables or secrets management instead
#    生产环境建议使用环境变量或密钥管理系统
#
# 6. Test configuration with: curl https://auth.lurus.cn/.well-known/openid-configuration
#    测试配置：curl https://auth.lurus.cn/.well-known/openid-configuration
